<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="grongier@intersystems.com" /><link rel="canonical" href="https://grongierisc.github.io/interoperability-embedded-python/debug/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Debugging - IoP (Interoperability On Python)</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Debugging";
        var mkdocs_page_input_path = "debug.md";
        var mkdocs_page_url = "/interoperability-embedded-python/debug/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> IoP (Interoperability On Python)
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started/installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started/first-steps/">First Steps</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started/register-component/">Register Component</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API documentation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../command-line/">Command Line Interface</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../python-api/">Python API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../component-interaction/">Component Interaction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dtl/">DTL Support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../logging/">Logging</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Debugging</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#context">Context</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#remote-debugging">Remote Debugging</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#debugging-options">Debugging Options</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#debugging-with-vscode">Debugging with VSCode</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#example">Example</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#local-debugging">Local Debugging</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#local-installation">Local Installation</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#debugging">Debugging</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docker-container">Docker Container</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tips">Tips</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#use-unit-tests">Use unit tests</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#use-if-name-main">Use if name == 'main'</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#use-tracebacks">Use tracebacks</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../prod-settings/">Production Settings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../venv/">Venv Support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wrapper/">Wrapper Support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../settings/">Settings</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Contributing</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../contributing/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../code-of-conduct/">Code of Conduct</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../example/">Examples</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../useful-links/">Useful Links</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../changelog/">Changelog</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../credits/">Credits</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../benchmarks/">Benchmarks</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">IoP (Interoperability On Python)</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API documentation</li>
      <li class="breadcrumb-item active">Debugging</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="debug">Debug</h1>
<p>How to debug IoP code. </p>
<p>Before anything, I will put some context about IoP and IRIS.</p>
<p>Next, I will show how to debug the code.</p>
<p>Finally, we will give some tips about debugging.</p>
<h2 id="context">Context</h2>
<p>IoP is a Python library that helps to build interoperability solutions with IRIS.</p>
<p>IoP is based on <a href="https://docs.intersystems.com/iris20243/csp/docbook/DocBook.UI.Page.cls?KEY=AFL_epython">Embedded Python in IRIS</a>.</p>
<p>Embedded Python is a feature of IRIS that allows you to run Python code inside IRIS.</p>
<p>That means the python code is not running by a python interpreter, but by an IRIS process.</p>
<h2 id="remote-debugging">Remote Debugging</h2>
<p>To remote debug your code, you need IoP version 3.4.1 or later.</p>
<p>You will then have access to new options in the management portal.</p>
<p><img alt="Remote Debugging" src="../img/RemoteDebugOptions.png" /></p>
<h3 id="debugging-options">Debugging Options</h3>
<ul>
<li><strong>Enable Debugging</strong>: This option will enable the remote debugging.</li>
<li><strong>Debugging Port</strong>: This option will set the port for the remote debugging. The default port is 0. If you set it to 0, the system will choose a random port. You can also set it to a specific port.</li>
<li><strong>Debugging Interpreter</strong>: In the background, the system will create a new python interpreter. This option will set the interpreter to use. <strong>In most cases, you don't need to change this option.</strong></li>
</ul>
<p>Then when you start the process, you will see the following message in the logs:</p>
<p><img alt="Debugging Port" src="../img/RemoteDebugWaiting.png" /></p>
<p>This means that the system is waiting for a connection on the port you set.</p>
<p>Then you can connect to the port with your IDE.</p>
<p>If you wait too long, the system will close the port and you will need to restart the process.
<img alt="Debugging Port" src="../img/RemoteDebugToLate.png" /></p>
<p>If VsCode is connected to the port, you will see the following message in the logs:
<img alt="Debugging Port" src="../img/RemoteDebugSuccess.png" />
This means that the system is connected to the port and you can start debugging.</p>
<h3 id="debugging-with-vscode">Debugging with VSCode</h3>
<p>To debug the code with VSCode, you need to have the following:
- <a href="https://code.visualstudio.com/">VSCode</a>
- <a href="https://marketplace.visualstudio.com/items?itemName=ms-python.python">Python extension</a></p>
<p>Then you need to create a new launch configuration for remote debugging.</p>
<p>You can follow the steps in the <a href="https://code.visualstudio.com/docs/python/debugging#_initialize-configurations">VSCode documentation</a> to initialize the configurations.
You can also use the following configuration:</p>
<pre><code class="language-json">{
    &quot;version&quot;: &quot;0.2.0&quot;,
    &quot;configurations&quot;: [
        {
            &quot;name&quot;: &quot;Python: Remote Debug&quot;,
            &quot;type&quot;: &quot;python&quot;,
            &quot;request&quot;: &quot;attach&quot;,
            &quot;connect&quot;: {
                &quot;host&quot;: &quot;&lt;IRIS_HOST&gt;&quot;,
                &quot;port&quot;: &lt;IRIS_DEBUG_PORT&gt;
            },
            &quot;pathMappings&quot;: [
                {
                &quot;localRoot&quot;: &quot;${workspaceFolder}&quot;,
                &quot;remoteRoot&quot;: &quot;/irisdev/app&quot; // for example path inside the container
                }
            ],
        }
    ]
}
</code></pre>
<p>You need to change the <code>&lt;IRIS_HOST&gt;</code> and <code>&lt;IRIS_DEBUG_PORT&gt;</code> to the host and port of your IRIS instance.
You also need to change the <code>pathMappings</code> to the path of your python file in IRIS and the path of your python file in your local machine.
The path in IRIS is the path of the file in the IRIS instance. The path in your local machine is the path of the file in your local machine.</p>
<h3 id="example">Example</h3>
<video controls width="640" height="360">
  <source src="/interoperability-embedded-python/img/IoPRemoteDebug.mp4" type="video/mp4">
</video>

<h2 id="local-debugging">Local Debugging</h2>
<p>The idea of local debugging is to use an native python interpreter and run the code outside IRIS. This way you can use the python debugger.</p>
<p>The main issue with this approach is that you must have a local instance of IRIS to be able to run the code.</p>
<p>When I mean a local instance, it can be a local installation of IRIS, or a docker container running IRIS.</p>
<p>I will explain first with a local installation of IRIS. Then I will show how to do the same with a docker container.</p>
<h3 id="local-installation">Local Installation</h3>
<p>To debug the code with a local installation of IRIS, you need to have the following:</p>
<ul>
<li><a href="https://docs.intersystems.com/irislatest/csp/docbook/Doc.View.cls?KEY=PAGE_deployment_install">Local installation of IRIS</a></li>
<li><a href="https://docs.intersystems.com/iris20243/csp/docbook/Doc.View.cls?KEY=GEPYTHON_prereqs#GEPYTHON_prereqs_version">Python interpreter compatible with the version of IRIS</a></li>
<li><a href="https://github.com/grongierisc/iris-embedded-python-wrapper">Iris embedded python wrapper</a></li>
</ul>
<p>After you have all the requirements, you can start the IRIS instance and run the python code.</p>
<h4 id="debugging">Debugging</h4>
<p>To debug the code, you can use the python debugger.</p>
<p>Example with VsCode:</p>
<ol>
<li>Open the code in VsCode to an existing folder.</li>
</ol>
<p>For example, you can use this git repository:</p>
<pre><code class="language-bash">git clone https://github.com/grongierisc/iris-python-interoperability-template
</code></pre>
<p>Open the folder <code>iris-python-interoperability-template</code> in VsCode.</p>
<pre><code class="language-bash">code iris-python-interoperability-template
</code></pre>
<p><img alt="Open the folder in VsCode" src="../img/vscode_open.png" /></p>
<ol>
<li>Install the python extension.</li>
</ol>
<p>Go to the extensions tab and search for <code>Python</code>.</p>
<p><img alt="Install the python extension" src="../img/vscode_python_extension.png" /></p>
<ol>
<li>Create a virtual environment and select it.</li>
</ol>
<pre><code class="language-bash">python -m venv .venv
source .venv/bin/activate
</code></pre>
<p>And select the virtual environment in VsCode.</p>
<p><img alt="Select the virtual environment" src="../img/vscode_select_venv.png" /></p>
<ol>
<li>Install the dependencies.</li>
</ol>
<pre><code class="language-bash">pip install -r requirements.txt
</code></pre>
<ol>
<li>Run the code in debug mode.</li>
</ol>
<p>Open the file <code>src/python/reddit/bo.py</code>, put a breakpoint in the line 26.</p>
<p><img alt="Put a breakpoint" src="../img/vscode_breakpoint.png" /></p>
<p>And run the code in debug mode.</p>
<p><img alt="Run the code in debug mode" src="../img/vscode_debug.png" /></p>
<p>And you can debug the code.</p>
<p><img alt="Debug the code" src="../img/vscode_debugging.png" /></p>
<h3 id="docker-container">Docker Container</h3>
<p>The general idea is the same as the local installation.</p>
<p>The main difference is that you need to have a attached VSCode to the docker container.</p>
<p>For that, you can use the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">Remote - Containers</a> extension.</p>
<p>Then you can attach the VSCode to the docker container and follow the same steps as the local installation.</p>
<h2 id="tips">Tips</h2>
<h3 id="use-unit-tests">Use unit tests</h3>
<p>The best way to debug the code is to use unit tests.</p>
<p>You can use the python unittest library to write unit tests or pytest.</p>
<p>You have examples in <a href="https://github.com/grongierisc/iris-python-interoperability-template/tree/master/src/python/tests">iris-python-interoperability-template</a>.</p>
<h3 id="use-if-name-main">Use if <strong>name</strong> == '<strong>main</strong>'</h3>
<p>You can use the <code>if __name__ == '__main__':</code> to run the code only when you run the python file.</p>
<p>Example:</p>
<pre><code class="language-python">def my_function():
    print('Hello World')

if __name__ == '__main__':
    my_function()
</code></pre>
<p>You also have examples in <a href="https://github.com/grongierisc/iris-python-interoperability-template/blob/master/src/python/reddit/bo.py#L86">iris-python-interoperability-template</a>.</p>
<h3 id="use-tracebacks">Use tracebacks</h3>
<p>Since iop version 3.4.3, you can use the <code>%traceback</code> setting to enable or disable tracebacks in the message log.</p>
<p>This can help you to see the stack trace of the error and understand what is happening in the code.</p>
<p>With tracebacks enabled: </p>
<p><img alt="Traceback enabled" src="../img/traceback_enable.png" /></p>
<p>With tracebacks disabled:</p>
<p><img alt="Traceback disabled" src="../img/traceback_disable.png" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../logging/" class="btn btn-neutral float-left" title="Logging"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../prod-settings/" class="btn btn-neutral float-right" title="Production Settings">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../logging/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../prod-settings/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
